/* knockout.contextmenu v0.4.0
   Nicol√°s Escalante - nlante@gmail.com
   Issues: https://github.com/nescalante/knockout.contextmenu/issues
   License: MIT */

!function(a){"use strict";function b(b,c){function d(){f&&f.parentNode&&f.parentNode.removeChild(f),f=null}function e(a){for(var b=0;b<g.length;b++)if(g[b].element===a)return g[b]}var f,g=[],h=b.utils,i=h.registerEventHandler,j=b.isObservable;i(c,"click",function(a){var b=a.which||a.button;a.defaultPrevented||1!==b||d()}),h.contextMenu={getMenuFor:function(a,b){var c=e(a);return c?c.get(b):void 0},openMenuFor:function(a,b){var c=e(a);return c?c.open(b):void 0}},b.bindingHandlers.contextMenu={init:function(e,h,k,l){function m(a){return a.pageX?a.pageX:a.clientX?a.clientX+(c.documentElement.scrollLeft||c.body.scrollLeft):null}function n(a){return a.pageY?a.pageY:a.clientY?a.clientY+(c.documentElement.scrollTop||c.body.scrollTop):null}function o(a){var b;if(r=p(a),b=r.element,d(),b){if(b.style.visibility="hidden",(c.body||c).appendChild(b),a){var g=window.innerHeight+window.pageYOffset,h=window.innerWidth+window.pageXOffset;n(a)+b.offsetHeight>g?b.style.top=1*(g-b.offsetHeight-10)+"px":b.style.top=n(a)+"px",m(a)+b.offsetWidth>h?b.style.left=1*(h-b.offsetWidth-10)+"px":b.style.left=m(a)+"px",a.preventDefault(),a.stopPropagation()}else b.style.top=e.offsetTop+e.offsetHeight+"px",b.style.left=e.offsetLeft+e.offsetWidth+"px";b.style.visibility=""}return f=b,r}function p(a){function d(a){var b=q(a),c=[],d="";b.isVisible&&(g=g||b.isBoolean,b.id&&(d=b.id),b.isChecked&&c.push("checked"),b.isDisabled&&c.push("disabled"),b.isSeparator&&c.push("separator"),b.url&&c.push("with-url"),h.push("<li "+(d?'id="'+d+'" ':"")+' class="'+c.join(" ")+'">'+b.html+"</li>"),j.push(b.action)),k.push(b)}var e,g=!1,h=[],j=[],k=[],m=Object.keys(b.isObservable(s)?s():s);return m.forEach(function(a){d(a)}),h.length&&(e=c.createElement("div"),e.className=u,e.innerHTML='<ul class="'+(g?"has-checks":"")+'">'+h.join("")+"</ul>",h.forEach(function(a,b){i(e.children[0].children[b],"click",function(a){var c=j[b](l,a);!c&&a&&a.preventDefault()})})),{element:e,items:k,open:o,hide:function(){e&&e.parentNode&&e.parentNode.removeChild(e),f=null}}}function q(c){function d(a,b){var d=c+" option must have an action or an url.";if(p)return!1;if(j(h)&&"boolean"==typeof h())h(!h());else if("object"==typeof h){if(!(h.action||k||q))throw d;h.action&&(j(h.action)&&"boolean"==typeof h.action()?h.action(!h.action()):h.action(a,b))}else{if("function"!=typeof h)throw d;h(a,b)}return!0}var e="",f="",g=b.isObservable(s)?s()[c]:s[c],h=g||{},i=h.id,k=j(h.url)?h.url():h.url,l=h.visible===a||null===h.visible||j(h.visible)&&h.visible()||!j(h.visible)&&!!h.visible,m=!1,n=!h.disabled||j(h.disabled)&&!h.disabled()||j(h.enabled)&&h.enabled()||!j(h.enabled)&&!!h.enabled,o=!1,p=!n,q=!!g.separator;return q||(e=j(h.text)?h.text():h.text,e||(e=c),f=k?'<a href="'+k+'">'+e+"</a>":e),(j(h)&&"boolean"==typeof h()||j(h.action)&&"boolean"==typeof h.action())&&(o=!0,(h.action&&h.action()||"function"==typeof h&&h())&&(m=!0)),{html:f,text:e,url:k,id:i,isVisible:l,isChecked:m,isEnabled:n,isDisabled:p,isBoolean:o,isSeparator:q,action:d}}var r,s=h()||{},t=k(),u=t.contextMenuClass||"context-menu";t.bindMenuOnClick&&i(e,"click",o),(t.bindMenuOnContextMenu===a||t.bindMenuOnContextMenu)&&i(e,"contextmenu",o),g.push({element:e,get:function(){return r},open:o,hide:function(){r&&r.hide()}})}}}typeof ko!=a+""&&typeof document!=a+""&&b(ko,document),typeof module!=a+""&&module.exports&&(module.exports=b)}();